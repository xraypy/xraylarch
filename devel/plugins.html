
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>11.3. Plugins &mdash; larch 0.9.27 documentation</title>
    
    <link rel="stylesheet" href="../_static/larchdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9.27',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="larch 0.9.27 documentation" href="../index.html" />
    <link rel="up" title="11. Programming with Larch" href="index.html" />
    <link rel="next" title="11.4. Using Larch from Python" href="frompython.html" />
    <link rel="prev" title="11.2. Modules" href="modules.html" />
  <script type="text/x-mathjax-config">
     MathJax.Hub.Config({ "TeX": {Macros: {AA : "{\\unicode{x212B}}"}},
                         "HTML-CSS": {scale: 90}});
  </script>

  </head>
  <body>
<div style=" color: #c5daba;  text-align: left; height:85px; padding: 0px">
<table border=1>
  <tr>
    <td width=20% padding=0 rowspan=2>
	<a href="../index.html">
         <img src="../_static/larchcones.png" height=80px alt="larchcones"/></a>
    </td>
    <td width=54% padding=0>
	<font size=+3><a href="../index.html" style="color: #772211">Larch</a></font>
    </td>
    <td width=8%>
	<a href="../installation/index.html" style="color: #772211"> Install</a>
	</td>
    <td width=8%>
	<a href="http://github.com/xraypy/xraylarch" style="color: #772211"> Develop</a>
        </td>
    <td width=8%>
	<a href="../community.html" style="color: #772211"> Community</a></td>
        </td>
   </tr>
  <tr>
   <td width=54% padding=0>
	 <font size=+2><a href="../index.html" style="color: #772211">
   Data Analysis Tools for X-ray Spectroscopy </a></font>
   </td>
    <td width=8%> <a href="../contents.html" style="color: #772211"> Contents</a></td>
    <td width=8%> <a href="../tutorial/index.html" style="color: #772211"> Tutorial</a></td>
    <td width=8%> <a href="../overview/index.html" style="color: #772211"> Overview</a></td>
   </tr></table>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="frompython.html" title="11.4. Using Larch from Python"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="modules.html" title="11.2. Modules"
             accesskey="P">previous</a> |</li>
   <li>[<a href="../data/index.html">Reading Data</a>|</li>
   <li><a href="../plotting/index.html">Plotting</a>|</li>
   <li><a href="../fitting/index.html">Fitting Data</a>|</li>
   <li><a href="../xafs/index.html">XAFS Analysis</a>|</li>
   <li><a href="../xray/index.html">Xray Databases</a>|</li>
   <li><a href="../xrf/index.html">XRF Analysis</a>|</li>
   <li><a href="index.html">Scripting</a>]</li>

          <li><a href="index.html" accesskey="U">11. Programming with Larch</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">11.3. Plugins</a><ul>
<li><a class="reference internal" href="#locations-of-plugins">11.3.1. Locations of Plugins</a></li>
<li><a class="reference internal" href="#customizing-plugins-and-folders-of-plugins">11.3.2. Customizing Plugins and  Folders of Plugins</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="modules.html"
                        title="previous chapter">11.2. Modules</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="frompython.html"
                        title="next chapter">11.4. Using Larch from Python</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/devel/plugins.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="plugins">
<span id="plugins-section"></span><h1>11.3. Plugins<a class="headerlink" href="#plugins" title="Permalink to this headline">¶</a></h1>
<p>A Larch plugin is a Python module that adds functionality to Larch at
run-time.  Plugins are a powerful part of Larch that allow it to be
extended without the requiring detailed knowledge of all of Larch's
internals.  Generally speaking, plugins will define new functions or data
to become part of the Larch framework.  Functions defined in plugins can
access the Larch interpreter session, including creating or manipulating
Groups in Larch's symbol table.  Essentially all the scientific
functionality of Larch is implemented as plugins.</p>
<span class="target" id="module-larch"></span><p>There are a few points to consider for writing plugins.  First, in order
for a plugin function to interact with the running Larch interpreter, it
needs a <tt class="docutils literal"><span class="pre">_larch</span></tt> keyword argument.  To be clear, the function does not
require a <tt class="docutils literal"><span class="pre">_larch</span></tt> keyword argument, but if the function does have a
<tt class="docutils literal"><span class="pre">_larch</span></tt> keyword argument, it will be used to pass in the current larch
interpreter.  Normally, you will only really need the <tt class="docutils literal"><span class="pre">symtable</span></tt>
attribute of the <tt class="docutils literal"><span class="pre">_larch</span></tt> variable which holds the symbol table used, but
you can interact with any part of the interpreter if you need to.</p>
<p>Second, all functions (or data resources) that are to be added to Larch
need to be <em>registered</em>.  This is done by defining a function called
<tt class="xref py py-func docutils literal"><span class="pre">registerLarchPlugin()</span></tt> that returns a tuple containing the name of the
group containing the added functions, and a dictionary with keys used for
the names to be put into the Larch symbol table, and values of the functions
or data to be used. of Larch symbol. A simple plugin module would
look like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_larch</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c"># Note: larch instance passed in to &#39;_larch&#39;</span>
    <span class="k">if</span> <span class="n">_larch</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">_larch</span><span class="o">.</span><span class="n">symtable</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;created by myfunc&#39;</span><span class="p">)</span>

    <span class="n">group</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">group</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
    <span class="n">group</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="k">return</span> <span class="n">group</span>

<span class="k">def</span> <span class="nf">registerLarchPlugin</span><span class="p">():</span> <span class="c"># must have a function with this name!</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&#39;mymod&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;func&#39;</span><span class="p">:</span> <span class="n">myfunc</span><span class="p">})</span>
</pre></div>
</div>
<p>This would create a top-level Larch group <tt class="docutils literal"><span class="pre">mymod</span></tt> (if it didn't already
exist), and create a function <tt class="docutils literal"><span class="pre">func</span></tt> in this group that held the python
function <tt class="docutils literal"><span class="pre">myfunc</span></tt>.  To use this function from the Larch interpreter, you
would use something like:</p>
<div class="highlight-python"><div class="highlight"><pre>larch&gt; out = mymod.func(12, &#39;a string&#39;)
larch&gt; print out.x, out.y, out.z
12  &#39;a string&#39; 100
</pre></div>
</div>
<p>This plugin simply puts data into a Group, but of course you can do much
more complicated work inside the function.</p>
<dl class="function">
<dt>
<tt class="descname">registerLarchPlugin():</tt></dt>
<dd><p>register a set of functions or data resources defined in the module into
the current Larch interpreter.   This function should return a tuple of
(GroupName, Symbols_Dictionary), where the Group name is the
top-level Group to place the data in, and the Symbols dictionary maps
the values (functions or data in the Python module) to names in the
Larch Group.</p>
</dd></dl>

<div class="section" id="locations-of-plugins">
<h2>11.3.1. Locations of Plugins<a class="headerlink" href="#locations-of-plugins" title="Permalink to this headline">¶</a></h2>
<p>Plugins are meant to be long-lived and reused, and so are not expected to
be placed in the current working directory.  Plugins are located in the the
installed Larch Plugin folder ( $HOME/.larch/plugins/ on Unix or Mac OS X
or C:\Users\USERNAME\larch\plugins on Windows).</p>
<p>Plugins in the user's Larch Plugin folder can be added into the current
Larch session with the <a class="reference internal" href="../tutorial/builtins.html#add_plugin" title="add_plugin"><tt class="xref py py-func docutils literal"><span class="pre">add_plugin()</span></tt></a> function.</p>
<dl class="function">
<dt id="larch._builtin.add_plugin">
<tt class="descclassname">_builtin.</tt><tt class="descname">add_plugin</tt><big>(</big><em>python_file</em><big>)</big><a class="headerlink" href="#larch._builtin.add_plugin" title="Permalink to this definition">¶</a></dt>
<dd><p>add a plugin from the given plugin python file.  In contrast to the
<tt class="docutils literal"><span class="pre">import</span></tt> statement, <a class="reference internal" href="../tutorial/builtins.html#add_plugin" title="add_plugin"><tt class="xref py py-func docutils literal"><span class="pre">add_plugin()</span></tt></a> will install the resources
defined by <tt class="xref py py-func docutils literal"><span class="pre">registerLarchPlugin()</span></tt> every time it is run.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>python_file</strong> -- name of Python file containing plugin code.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><tt class="docutils literal"><span class="pre">True</span></tt> on success, <tt class="docutils literal"><span class="pre">False</span></tt> on error</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>If the above plugin file is saved in a file named <cite>myplugin.py</cite> in the
user's Larch Plugin folder, then doing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">larch</span><span class="o">&gt;</span> <span class="n">add_plugin</span><span class="p">(</span><span class="s">&#39;myplugin&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>will add a top-level group <tt class="docutils literal"><span class="pre">mymod</span></tt> with the <tt class="docutils literal"><span class="pre">func</span></tt> function, as described
above.  For commonly used plugins, the <a class="reference internal" href="../tutorial/builtins.html#add_plugin" title="add_plugin"><tt class="xref py py-func docutils literal"><span class="pre">add_plugin()</span></tt></a> call can be added
to your startup script (<cite>init.lar</cite> in the User's Larch folder).  Since
<tt class="xref py py-func docutils literal"><span class="pre">registerLarchPlugin()</span></tt> is re-applied every time <a class="reference internal" href="../tutorial/builtins.html#add_plugin" title="add_plugin"><tt class="xref py py-func docutils literal"><span class="pre">add_plugin()</span></tt></a> is
run, this provides a convenient way to develop and debug plugins.</p>
<p>Many plugins are installed into the Larch system folder.  These are
organized into sub-folders, and generally each plugin folder contains
mulitple files (modules) providing Larch functionality.</p>
</div>
<div class="section" id="customizing-plugins-and-folders-of-plugins">
<h2>11.3.2. Customizing Plugins and  Folders of Plugins<a class="headerlink" href="#customizing-plugins-and-folders-of-plugins" title="Permalink to this headline">¶</a></h2>
<p>Plugins are meant to be organized in folders.  The standard system plugins
have several folders, each with several functions.  Generally every file
(module) in the folder is treated as a plugin module, and if it has a
function <tt class="xref py py-func docutils literal"><span class="pre">registerLarchPlugin()</span></tt>, that will be run to place functions
in the Larch interpreter.</p>
<p>There are a few ways to control the plugins beyond the
<tt class="xref py py-func docutils literal"><span class="pre">registerLarchPlugin()</span></tt> function.  First, each module file can have a
<a class="reference internal" href="#larch.initializeLarchPlugin" title="larch.initializeLarchPlugin"><tt class="xref py py-func docutils literal"><span class="pre">initializeLarchPlugin()</span></tt></a> function that will be run immediately after
the plugin is registered to initialize plugin functionality.</p>
<dl class="function">
<dt id="larch.initializeLarchPlugin">
<tt class="descclassname">larch.</tt><tt class="descname">initializeLarchPlugin</tt><big>(</big><em>_larch=None</em><big>)</big><a class="headerlink" href="#larch.initializeLarchPlugin" title="Permalink to this definition">¶</a></dt>
<dd><p>initializes a Larch plugin.  If defined for a plugin, this function is
run immediately after installing all the symbols.</p>
</dd></dl>

<p id="index-0">Secondly, you may want to tell larch to look only at certain files within
the plugin folder for plugins.  To do this, simply include a file named
<cite>plugins.txt</cite> in the plugin folder that lists the files (one per line) to
use for plugins.</p>
<p id="index-1">Finally, a Larch plugin may depend on third party Python modules that may
not be installed or available on all systems.  This should be considered
acceptable -- certain plugins may not work on all systems, but that
shouldn't cause problems for the other functionality.  To specify which
Python modules (and which versions of the modules), a particular plugin
depends on, you can include a file <cite>requirements.txt</cite> in the plugin folder
which contains the module name and version strings, one per line.  A
typical <cite>requirements.txt</cite> file might look like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">epics</span><span class="o">&gt;=</span><span class="mf">3.1</span>
<span class="n">scipy</span><span class="o">&gt;=</span><span class="mf">0.13</span>
</pre></div>
</div>
<p>to specify which modules and minimal versions for the plugin files in that
folder to work.  If these requirements are not satisfied, the modules will
not be installed.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="frompython.html" title="11.4. Using Larch from Python"
             >next</a> |</li>
        <li class="right" >
          <a href="modules.html" title="11.2. Modules"
             >previous</a> |</li>
   <li>[<a href="../data/index.html">Reading Data</a>|</li>
   <li><a href="../plotting/index.html">Plotting</a>|</li>
   <li><a href="../fitting/index.html">Fitting Data</a>|</li>
   <li><a href="../xafs/index.html">XAFS Analysis</a>|</li>
   <li><a href="../xray/index.html">Xray Databases</a>|</li>
   <li><a href="../xrf/index.html">XRF Analysis</a>|</li>
   <li><a href="index.html">Scripting</a>]</li>

          <li><a href="index.html" >11. Programming with Larch</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright Matthew Newville, The University of Chicago, 2012.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>